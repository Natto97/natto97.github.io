规范渗透测试报告中的漏洞名称以及修复建议，用于规范渗透测试报告的编写，统一漏洞名称，漏洞描述，入行时间短，难免因为经验不足重复失误，如果有地方需要加以改正，请联系我，期待与您的交流。

* [SQL注入](#SQL注入漏洞)
* [跨站脚本攻击](#跨站脚本攻击)
* [弱口令](#弱口令)
  * [系统弱口令](#系统弱口令)
  * [数据库弱口令](#数据库弱口令)
  * [SSH 登录弱口令](#SSH登录弱口令)
* [暴力破解](#暴力破解)
* [任意文件上传](#任意文件上传)
* [任意文件下载](#任意文件下载)
* [任意文件读取](#任意文件读取)
* [任意文件包含](#任意文件包含)
* [远程命令执行漏洞](#远程命令执行漏洞)
* [未授权访问](#未授权访问)
  * [Redis未授权访问](#Redis未授权访问)
  * [Jenkins未授权访问](#Jenkins未授权访问)
  * [MongoDB未授权访问](#MongoDB未授权访问)
  * [ZooKeeper未授权访问](#ZooKeeper未授权访问)
  * [Elasticsearch未授权访问](#Elasticsearch未授权访问)
  * [Memcache未授权访问](#Memcache未授权访问)
  * [Hadoop未授权访问](#Hadoop未授权访问)
  * [Docker未授权访问](#Docker未授权访问)
* [权限提升](#权限提升)
* [越权漏洞](#越权漏洞)
* [逻辑漏洞](#逻辑漏洞)
* [明文传输漏洞](#明文传输漏洞)

# 一、常见漏洞

## SQL注入漏洞

**漏洞描述：**

由于应用程序缺少对输入进行安全性检查，攻击者利用现有应用程序，将恶意的SQL命令注入到后台数据库引擎执行，把一些包含攻击代码当做命令或者查询语句发送给解释器，这些恶意数据可以欺骗解释器，从而执行计划外的命令或者未授权访问数据。

**修复建议：**

1. 通过使用静态和动态测试，定期检查并发现应用程序中的SQL注入漏洞。
2. 通过正则规范用户输入，校验输入数据中是否包含SQL语句的保留字，如：SELECT，WHERE，EXEC，DROP等。或使用转义字符，来修复SQL注入漏洞，以便忽略掉一些特殊字符。
3. 通过使用参数化查询和对象关系映射(Object Relational Mappers，ORM)，来避免和修复注入漏洞。此类查询通过指定参数的占位符，以便数据库始终将它们视为数据，而非SQL命令的一部分。
4. 通过对数据库强制执行最小权限原则，来减缓SQL注入漏洞的影响。籍此，应用程序的每一个软件组件都只能访问、并仅影响它所需要的资源。
5. 对访问数据库的Web应用程序采用Web应用防火墙(Web Application Firewall，WAF)。这有助于识别出针对SQL注入的各种尝试，进而防止此类尝试作用到应用程序上。
6. 避免网站显示SQL错误信息，比如类型错误、字段不匹配等，防止攻击者利用这些错误信息进行一些判断。

## 跨站脚本攻击

**漏洞描述：**

跨站脚本攻击，是WEB程序中一种常见的漏洞。其主要的攻击手段是在在利用网站上的可由用户输入信息的地方，恶意注入含有攻击性的脚本，达到攻击网站或者窃取用户cookied等隐私信息的目的。

**修复建议：**

1. 在表单提交或者url参数传递前，对需要的参数进行过滤。
2. 将重要的cookie标记为http only, 这样的话Javascript 中的document.cookie语句就不能获取到cookie了。
3. 表单数据规定值的类型，例如：年龄应为只能为int、name只能为字母数字组合。
4. 对数据进行Html Encode 处理。
5. 过滤或移除特殊的Html标签， 例如: <script>, <iframe> , &lt; for <, &gt; for >, &quot for。
6. 过滤JavaScript 事件的标签。例如 "onclick=", "onfocus" 等等。

## 弱口令
### 系统弱口令

**漏洞描述：**

弱口令漏洞指系统口令的长度太短或者复杂度不够，如仅包含数字或字母等，弱口令容易被破解，一旦被攻击者获取，可用来直接登录系统，读取甚至修改网站代码。

**修复建议：**

1. 修改口令，增加口令复杂度，如包含大小写字母、数字和特殊字符等。
2. 修改默认口令，避免默认口令被猜解。
3. 指定健壮的口令策略，比如指定每隔30天修改一次密码，密码不得与历史密码相同。
  ### 数据库弱口令

**漏洞描述：**

数据库弱口令漏洞指数据库管理员账号对应密码的长度太短或者复杂度不够，仅包含数字，或仅包含字母等，弱口令容易被破解，一旦被攻击者获取，可用来直接登录数据库系统，读取甚至修改服务器上的文件，或者导致服务器沦陷。

**修复建议：**

1. 修改口令，增加口令复杂度，如包含大小写字母、数字和特殊字符等。
2. 修改默认口令，避免默认口令被猜解。
3. 指定健壮的口令策略，比如指定每隔30天修改一次密码，密码不得与历史密码相同。
### SSH登录弱口令

**漏洞描述：**

SSH 弱口令漏洞指 Linux 系统口令的长度太短或者复杂度不够，如仅包含数字，或仅包含字母等，弱口令容易被破解。攻击者可以利用弱口令直接登录SSH服务器，读取甚至修改网站代码，或者导致服务器沦陷。

**修复建议：**

1. 修改口令，增加口令复杂度，如包含大小写字母、数字和特殊字符等。
2. 修改默认口令，避免默认口令被猜解。
3. 指定健壮的口令策略，比如指定每隔30天修改一次密码，密码不得与历史密码相同。
## 暴力破解

**漏洞描述：**

暴力破解攻击是指攻击者通过系统地组合并尝试所有的可能性以破解用户的用户名、密码等敏感信息。攻击者往往借助自动化脚本工具来发动暴力破解攻击，理论上，只要拥有性能足够强的计算机和足够长的时间，大多密码均可以被破解出来。

**修复建议：**

1. 制定密码复杂度策略，并进行服务加固。密码的长度要大于 8 位，且最好大于 20 位；密码应由数字、大小写字母和特殊符号混合组成；密码的最长有效期为 90 天。
2. 增加验证码机制，每次验证加入Token参数，保证验证码复杂度，防止被自动化识别。
3. 配置好网络访问控制。严格限制将高危服务管理端口直接发布到互联网；建议您使用 VPN 和堡垒机的方式集中管理和审计。
4. 提高内部全员安全意识，禁止借用或共享使用账号。
## 任意文件上传

**漏洞描述：**

由于代码作者没有对访客提交的数据进行检验或者过滤不严，可以直接提交修改过的数据绕过扩展名的检验，导致攻击者通过上传木马文件，直接得到WEBSHELL，可以读取修改服务器上的文件，或者导致服务器沦陷。

**修复建议：**

1. 对上传的文件，返回数据包时隐藏上传文件的路径
2. 对文件格式限制，只允许某些格式上传。
3. 对文件格式进行校验，前端跟服务器都要进行校验（前端校验扩展名，服务器校验扩展名、Content_Type等），进行MIME文件类型安全检测，上传的文件大小限制。
4. 将上传目录防止到项目工程目录之外，当做静态资源文件路径，并且对文件的权限进行设定，禁止文件下的执行权限。
## 任意文件下载

**漏洞描述：**

由于未对用户查看或下载的文件做限制，恶意用户就能够查看或下载任意的文件，可以是源代码文件、敏感文件等、如脚本代码、服务及系统配置文件等，攻击者可用得到的代码进一步代码审计，得到更多可利用漏洞。

**修复建议：**

1. 过滤.(点)，使用户在url中不能回溯上级目录。
2. 正则严格判断用户输入参数的格式，限定用户访问范围。
3. 将下载区独立出来，放在项目路径外，给每个下载资源固定的URL，而不是所有的下载资源都是统一的URL。
## 任意文件读取

**漏洞描述：**

通过提交专门设计的输入，攻击者就可以在被访问的文件系统中读取或写入任意内容，往往能够使攻击者从服务器上获取敏感信息文件。

**修复建议**

1. 过滤点(.)使用户在url中不能回溯上级目录。
2. 正则严格判断用户输入参数的格式，限定用户可访问范围。

## 任意文件包含

**漏洞描述：**

通过引入文件时，引用的文件名，用户可控，由于传入的文件名没有经过合理的校验，或者检验被绕过，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。

**修复建议：**

1. php中可以使用open_basedir配置限制访问权限在指定区域。
2. 过滤 . (点) / (斜杠) \ (反斜杠)。
3. 禁止服务器远程文件包含。
## 远程命令执行漏洞

**漏洞描述：**

远程命令执行漏洞，用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，可能会允许攻击者通过改变 $PATH 或程序执行环境的其他方面来执行一个恶意构造的代码。

**修复建议：**

1. 建议假定所有输入都是可疑的，尝试对所有输入提交可能执行命令的构造语句进行严格的检查或者控制外部输入，系统命令执行函数的参数不允许外部传递。
2. 不仅要验证数据的类型，还要验证其格式、长度、范围和内容。
3. 不要仅仅在客户端做数据的验证与过滤，关键的过滤步骤在服务端进行。
4. 对输出的数据也要检查，数据库里的值有可能会在一个大网站的多处都有输出，即使在输入做了编码等操作，在各处的输出点时也要进行安全检查。
5. 在发布应用程序之前测试所有已知的威胁。

## 未授权访问

### Redis未授权访问

**漏洞描述：**

Redis因配置不当可以未授权访问。攻击者无需认证访问到内部数据，可导致敏感信息泄露，也可以恶意执行flushall来清空所有数据。如果Redis以root身份运行，可以给root账户写入SSH公钥文件，直接通过SSH登录受害服务器，攻击者还可以写入WEBSHELL，或者通过计划任务反弹服务器shell。

**修复建议：**

1. 配置redis.conf，默认只对本地开放。
2. 添加登陆密码，进行身份验证。
3. 在需要对外开放的时候修改默认端口。
4. 配合iptables限制开放。
### Jenkins未授权访问

**漏洞描述：**

默认情况下Jenkins面板中用户可以选择执行脚本界面来操作一些系统层命令，攻击者可通过未授权访问漏洞或者暴力破解用户密码等进脚本执行界面从而获取服务器权限，可导致服务器沦陷，或写入WEBSHELL。

**修复建议：**

1. 禁止把Jenkins直接暴露在公网。
2. 添加认证，设置强密码复杂度及设置账号锁定机制。
### MongoDB未授权访问

**漏洞描述：**

开启MongoDB服务时不添加任何参数时,默认是没有权限验证的,而且可以远程访问数据库，登录的用户可以通过默认端口无需密码对数据库进行增、删、改、查等任意高危操作。

**修复建议：**

1. 为MongoDB添加认证。
2. 禁用HTTP和REST端口。
3. 限制绑定IP。
### ZooKeeper未授权访问

**漏洞描述：**

Zookeeper的默认开放端口是2181。Zookeeper安装部署之后默认情况下不需要任何身份验证，造成攻击者可以远程利用Zookeeper，通过服务器收集敏感信息或者在Zookeeper集群内进行破坏（比如：kill命令）。攻击者能够执行所有只允许由管理员运行的命令。

**修复建议：**

1. 禁止把Zookeeper直接暴露在公网。
2. 添加访问控制，根据情况选择对应方式（认证用户，用户名密码）。
3. 绑定指定IP访问。
### Elasticsearch未授权访问

**漏洞描述：**

Elasticsearch是一款java编写的企业级搜索服务。越来越多的公司使用ELK作为日志分析，启动此服务默认会开放9200端口，可被非法操作数据。

**修复建议：**

1. 防火墙上设置禁止外网访问9200端口。
2. 使用Nginx搭建反向代理，通过配置Nginx实现对Elasticsearch的认证。
3. 限制IP访问，绑定固定IP。
4. 在config/elasticsearch.yml中为9200端口设置认证。
### Memcache未授权访问

**漏洞描述：**

Memcached是一套常用的key-value缓存系统，由于它本身没有权限控制模块，所以对公网开放的Memcache服务很容易被攻击者扫描发现，攻击者通过命令交互可直接读取Memcached中的敏感信息。

**修复建议：**

1. 设置memchached只允许本地访问。
2. 禁止外网访问Memcached 11211端口。
3. 编译时加上–enable-sasl，启用SASL认证。

### Hadoop未授权访问

**漏洞描述：**

由于服务器直接在开放了Hadoop机器HDFS的50070 web端口及部分默认服务端口，黑客可以通过命令行操作多个目录下的数据，如进行删除，下载，目录浏览甚至命令执行等操作，产生极大的危害。

**修复建议：**

1. 如无必要，关闭Hadoop Web管理页面。
2. 开启身份验证，防止未经授权用户访问。
3. 设置“安全组”访问控制策略，将Hadoop默认开放的多个端口对公网全部禁止或限制可信任的IP地址才能访问包括50070以及WebUI等相关端口。
### Docker未授权访问

漏洞描述：

Docker Remote API是一个取代远程命令行界面（rcli）的REST API。通过 docker client 或者 http 直接请求就可以访问这个 API，通过这个接口，攻击者可以新建 container，删除已有 container，甚至是获取宿主机的 shell。

修复建议：

1. 在不必需的情况下，不要启用docker的remote api服务，如果必须使用的话，设置ACL，仅允许信任的来源IP连接，设置TLS认证。
2. 客户端连接时需要设置以下环境变量export DOCKER_TLS_VERIFY=1
> export DOCKER_CERT_PATH=~/.docker
export DOCKER_HOST=tcp://10.10.10.10:2375
export DOCKER_API_VERSION=1.12
3. 在 docker api 服务器前面加一个代理，例如 nginx，设置 401 认证

## 权限提升

**漏洞描述：**

权限提升是指利用系统中的安全漏洞或是别的方法使得自己突破了原来的限制，能够非法访问对方目录甚至是使得自己能够向管理员那样来获取整个系统控制，简称提权。

**修复建议：**

1. 定期进行固件、中间件的升级。
2. 不要给员工设置工作之外的权限。
3. 对文件格式限制，只允许某些格式上传。
## 越权漏洞

**漏洞描述：**

越权漏洞是比较常见的漏洞类型，越权漏洞可以理解为，一个正常的用户A通常只能够对自己的一些信息进行增删改查，但是由于程序员的一时疏忽，对信息进行增删改查的时候没有进行一个判断，判断所需要操作的信息是否属于对应的用户，可以导致用户A可以操作其他人的信息。​

**修复建议：**

1. 服务器端使用的是http服务而不是https，实际上还是可以在用户注册时通过抓包工具获取token来进行恶意操作，但加了权限认证之后黑客只能通过构造请求来对token对应的用户进行恶意操作。
2. 日常开发中要多留意业务逻辑可能出现的漏洞和水平权限漏洞或者其它未发现的漏洞。

## 逻辑漏洞

**漏洞描述：**

逻辑错误漏洞是指由于程序逻辑不严或逻辑太复杂，导致一些逻辑分支不能够正常处理或处理错误。

**修复建议：**

1. 在输入接口设置验证。
2. 注册界面的接口不要返回太多敏感信息，以防遭到黑客制作枚举字典。
3. 验证码请不要以短数字来甚至，最好是以字母加数字进行组合，并且验证码需要设定时间期限。

## 明文传输漏洞

**漏洞描述：**

http明文传输协议，导致管理员admin密码泄露，同时该系统登录失败处理功能存在安全问题，登录失败提示admin用户存在且密码错误信息，由于系统未应采用口令、密码技术、生物技术等两种或两种以上组合的鉴别技术对用户进行身份鉴别，导致可暴力破解，成功爆破出密码，一直攻击者成功破解或者截获密码，管理员可任意重置用户密码，导致系统数据泄露。

**修复建议：**

1. 建议应用系统增加除用户名/口令以外的身份鉴别技术，如密码/令牌、生物鉴别方式等，实现双因子身份鉴别，增强身份鉴别的安全力度。
2. 建议采用密码技术确保重要数据在传输过程中的保密性。



#  二、中间件漏洞


### 1.Nginx文件解析漏洞：

**漏洞等级：高危**

**漏洞描述：**

nginx文件解析漏洞产生的原因是网站中间键版本过低，可将任意文件当作php可执行文件来执行，可导致攻击者执行恶意代码来控制服务器。

### **漏洞危害：**

机密数据被窃取；

核心业务数据被篡改；

网页被篡改；

数据库所在服务器被攻击变为傀儡主机，导致局域网(内网)被入侵。

### **修复方案：**

升级中间件版本

部署Web应用防火墙

对数据库操作进行监控

修改php.ini文件，将cgi.fix_pathinfo的值设置为0；

在Nginx配置文件中添加以下代码：

```
 if( $fastcgi_script_name
 ~ ..*/.*php 
 ) {return 403;}
```

这行代码的意思是当匹配到类似test.jpg/a.php的URL时，将返回403错误代码。

### **2.OPTIONS漏洞**

### **漏洞描述：**

启用了不安全的http方法，Web服务器或应用程序服务器中间件是以不安全的方式配置 ，这些方法可能标识在服务器上启用了WebDAV，可能允许未授权的用户进行利用。此漏洞存在于IIS容器下，它扩展了HTTP协议，在GET/POST/HEAD等几个HTTP标准方法以外添加了一些新的方法，比如PUT/MOVE/COPY/DELETE方法，那么攻击者就可以通过PUT方法向服务器上传危险脚本。

### **漏洞测试：**

请求一个OPTIONS包，查看服务器所支持的HTTP方法。

OPTIONS / HTTP/1.1

Host:thief.one

### **漏洞危害：**

可能会在WEB服务器上上传、修改或删除WEB页面、脚本和文件，从而达到网页篡改，控制服务器的目的。

### **漏洞修复方案：**

如果服务器不需要支持WebDAV，请务必禁用此功能，或者禁止其不安全的HTTP请求方法。

### **3.**Struts2**远程命令执行**

Struts2远程命令执行漏洞是指代码未对用户可控参数做过滤，导致直接带入执行命令的代码中，可被用来执行任意命令。

### **可带来如下危害：**

攻击者可利用此漏洞直接执行操作系统命令获取WebShell，并且可通过该系统影响内网安全；

可被攻击者用来执行任意命令，写入后门等，进而完全控制服务器，造成严重后果。

**修复建议：**

将struts版本升级至最新版；

部署Web应用防火墙。

### 4.Tomcat远程部署漏洞

### **漏洞描述：**

这是JSP/PHP网站远程部署的一个工具，管理员只需要远程上传一个WAR格式的文件，便可以发布到网站，方便了开发人员部署代码的同时，也为黑客上传木马敞开了大门。

### **漏洞验证：**

通过访问：Http://localhost:8080/manager管理地址，尝试弱口令或默认口令，若能登陆成功，则存在此漏洞。

### **漏洞危害：**

导致被上传木马文件，控制服务器

### **漏洞修复：**

1.删除此管理页面

2.防火墙设置外网禁止访问此页面，或设置上传文件类型

3.中间件设置此页面访问权限

4.修改默认账号密码

5.升级tomcat为最新版本

### **5.JBoss**远程部署漏洞

### **漏洞描述：**

JBoss这是一个基于JavaEE的应用服务器，与tomcat类似的是jboss也有远程部署平台，但不需要登陆。

### **漏洞验证：**

尝试访问http://localhost:8080 因为一般管理后台为8080端口

### **漏洞危害：**

上传恶意木马文件，控制服务器

### **漏洞修复：**

1.开启jmx-console密码认证

2.删除jmx-console.war与web-console.war

### 6.WebLogic**远程部署漏洞**

### **漏洞描述：**

weblogic是一个基于JavaEE构架的中间件，安装完weblogic默认会监听7001端口，可以用来远程部署网站代码。

### **漏洞验证：**

默认后台地址：

http://localhost:7001/console/login/loginForm.jsp

### **漏洞危害：**

可上传恶意木马文件，控制服务器

### **漏洞修复：**

删除远程部署页面

### **7.**Apache解析漏洞

### **漏洞描述：**

Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断。比如 test.php.owf.rar “.owf”和”.rar” 这两种后缀是apache不可识别解析,apache就会把wooyun.php.owf.rar解析成php

### **漏洞检测：**

本地访问http://localhost/test.php.nmask，是否能被解析成php，若能则存在此漏洞。

### **漏洞危害：**

配置文件上传漏洞，可绕过waf／黑名单等限制，上传木马文件，控制服务器。

### **漏洞修复：**

1.apache配置文件，禁止.php.这样的文件执行，配置文件里面加入

```
<Files ~ “.(php.|php3.)”>
        Order Allow,Deny
        Deny from all
</Files>
```

2.用伪静态能解决这个问题，重写类似.php.*这类文件，打开apache的httpd.conf找到LoadModule rewrite_module modules/mod_rewrite.so把#号去掉，重启apache,在网站根目录下建立.htaccess文件,代码如下:

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .(php.|php3.) /index.php
RewriteRule .(pHp.|pHp3.) /index.php
RewriteRule .(phP.|phP3.) /index.php
RewriteRule .(Php.|Php3.) /index.php
RewriteRule .(PHp.|PHp3.) /index.php
RewriteRule .(PhP.|PhP3.) /index.php
RewriteRule .(pHP.|pHP3.) /index.php
RewriteRule .(PHP.|PHP3.) /index.php
</IfModule>
```

### **8.**Apache slowloris漏洞

### **漏洞描述：**

由于apache漏洞引发的拒绝服务攻击，其原理是以极低的速度往服务器发送HTTP请求。apache等中间件默认会设置最大并发链接数，而这种攻击就是会持续保持连接，导致服务饱和不可用。slowloris有点类似基于HTTP协议的SYN flood攻击。

### **漏洞检测：**

slowhttptest工具

### **漏洞危害：**

导致服务不可用，拒绝服务

### **漏洞修复：**

1.升级apache为最新版本

2.针对ip+cookie，限制访问频率（由于cookie可以更改，ip可以使用代理，或者肉鸡，也不可靠)

3.关闭apache最大连接数等，合理配置中间件，缓解ddos攻击。

**9.****IIS6.0****远程命令执行漏洞（cve-2017-7269）**

### **漏洞描述：**

当IIS6.0 开启了WebDav协议（开启PROPFIND协议）时存在此漏洞，缓冲区溢出导致远程命令执行。

### **漏洞检测：**

基于版本，windowsserver2003 R2+iis6.0+开启PROPFIND协议的服务器存在此漏洞。

### **漏洞危害：**

服务器可被远程命令执行

### **漏洞修复：**

1.关闭WebDAV服务

2.使用相关防护设备

### **10.**IIS**短文件名暴力猜解**

### **漏洞描述：**

为了兼容16位MS-DOS程序，Windows为文件名较长的文件（和文件夹）生成了对应的windows 8.3 短文件名，而生成的短文件名符合一定的规律，可以被暴力猜解。

### **漏洞检测：**

需要使用到通配符*，在windows中，*可以匹配n个字符，n可以为0。判断某站点是否存在IIS短文件名暴力破解漏洞，可以分别访问如下两个URL:

http://localhost/\*~1\*\*\*\*/a.aspx

http://localhost/l1j1e\*~1\*\*\*\*/a.aspx

这里我使用了4个星号，主要是为了程序自动化猜解，逐个猜解后缀名中的3个字符，实际上，一个星号与4个星号没有任何区别（上面已经提到，*号可以匹配空）。

如果访问第一个URL，返回404。而访问第二个URL，返回400。 则目标站点存在漏洞。

### **漏洞危害：**

猜解后台地址

猜解敏感文件，例如备份的rar、zip、.bak、.SQL文件等。

在某些情形下，甚至可以通过短文件名web直接下载对应的文件。比如下载备份SQL文件。

### **漏洞修复：**

升级.net framework

修改注册表键值：

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem

修改NtfsDisable8dot3NameCreation为1。再新建文件夹，将原网站目录内容拷贝进入新建的文件夹，使用新建的文件夹作为网站目录。

### **11.**java**反序列化漏洞**

### **漏洞描述：**

由于某些java容器（中间件）中的jar包存在反序列化漏洞，导致可被远程命令执行。影响容器有：jenkins，jboss，weblogic，websphere等。

### **漏洞检测：**

下载反序列化测试工具

### **漏洞危害：**

导致服务器被远程命令执行

### **漏洞修复：**

1.JBOSS

JBoss服务专有用户权限，没有登录权限，达到权限最小化,启用防火墙,防护防火墙策略设置，限定可以连接到JBoss的IP,安全验证配置,若是公开服务，需要在jmx-invoker-service.xml中开启权限验证,更新源代码,在JBoss源代码中打入最新的官方patch。

2.Weblogic

首先停止weblogic，在中间件modules目录下找到名为

com.bea.core.apache.commons.collections_x.x.x.jar文件

然后下载最新的commons-collections(bin包)，用压缩包中的commons-collections-x.x.x.jar替换有漏洞的jar包

jar包下载地址：

http://commons.apache.org/proper/commons-collections/download_collections.cgi

注意：保持原jar包的名字，即名字不变换掉jar包

最后启动weblogic。

#### 12.Apache **默认页面泄漏漏洞**

### **漏洞描述：**

Apache在安装后存在默认目录/icons/、/manual/

### **漏洞检测：**

在浏览器里输入

http://IP/icons/，http://IP/manual/

### **修复方案：**

1.对于Apache2，注释掉Apache配置文件中的目录配置中的以下两行：

Alias /icons/ "/usr/share/apache2/icons/"
 AliasMatch ^/manual(?:/(?:de|en|es|fr|ja|ko|ru))?(/.*)?$ "/usr/share/apache2/manual$1"

2.或者删除配置文件中的icons、manual两个目录。



# 三、系统漏洞


## 1.DNS域传送漏洞

###  漏洞描述：

网站DNS服务器配置不当，使得攻击者可获取DNS数据库的详细信息，导致所有域名DNS泄露，从而引起进一步的入侵。DNS主备之间的数据同步就会用到dns域传送，但如果配置不当，就会导致任何匿名用户都可以获取DNS服务器某一域的所有记录，将整个企业的基础业务以及网络架构对外暴露从而造成严重的信息泄露，甚至导致企业网络被渗透。

### 漏洞测试：

如dns服务器IP：1.1.1.1 测试域名为wooyun.org，测试命令如下：

![img](dns.png)

### 漏洞危害：

可导致攻击者获取DNS服务器某一域的所有记录，将整个单位的基础业务以及网络架构对外暴露从而造成严重的信息泄露，甚至导致内部网络被渗透；

攻击者可快速的判定出某个特定zone的所有主机，收集域信息，选择攻击目标，找出未使用的IP地址，攻击者可以绕过基于网络的访问控制。

### 修复方案：

 

严格限制允许区域传送的主机，例如一个主DNS服务器应该只允许它的从DNS服务器执行区域传送的功能；

在相应的zone、options中添加allow-transfer限制可以进行同步的服务器，有两种方式：限制IP、使用key认证。优先级为如果zone没有进行配置，则遵守options的设置。如果zone进行了配置，则遵守zone的设置。

## 2.SSH Services Port 22 Enabled

### 漏洞等级：中危

### 漏洞描述：

22号端口是linux服务器默认的远程登录管理端口，开放该端口可导致攻击者暴力破解服务器口令，若存在弱口令可直接被攻击者入侵。

### 漏洞危害：

黑客可能通过22端口试图连接远程控制；

如果主机的管理员密码过于简单，黑客就可以利用该漏洞，通过一些工具破解管理员密码，进而控制服务器。

### 漏洞修复方案：

建议利用组策略等方法关闭22端口。

部署防火墙拦截内网端口。

## 3.etBIOS Services Port 139 Enabled

### 漏洞描述：

即139端口漏洞，可通过139端口访问IPC$服务。

### 漏洞危害：

黑客可能通过139端口试图连接NetBIOS/SMB服务；

如果主机的管理员密码过于简单，黑客就可以利用该漏洞，通过一些工具破解管理员密码，进而控制服务器。

### 修复方案：

建议利用组策略等方法关闭139端口；

部署防火墙拦截内网端口。

## 4.OpenSSL HeartBleed**漏洞**

### 漏洞描述：

由于未能在memcpy()调用受害用户输入内容作为长度参数之前正确进行边界检查。攻击者可以追踪OpenSSL所分配的64KB缓存、将超出必要范围的字节信息复制到缓存当中再返回缓存内容，这样一来受害者的内存内容就会以每次64KB的速度进行泄露。

请求包中的数据实际长度远远小于其标明的length长度，Server端根据其标明的length长度分配了堆，然后尝试将请求包中的数据都拷贝过来形成回应包，于是便从内存中的请求包数据处开始复制了length个长度的字节，已经远远超过了数据的实际长度，从而造成数据的泄露。通过这种方式，一般可以得到SSL使用的Server端的私钥，从而获得SSL会话密钥，以及用户的账号等信息，最多64KB的数据。

### 漏洞危害：

攻击者可利用该漏洞直接读取服务器数据；

### 修复建议：

升级OpenSSL到最新版本。

使用DEPENSSL_NO_HEARTBEATS参数重新编译低版本的OpenSSL以禁用Heartbleed模块。

删除OpenSSL组件。

## **5.**docker remote API**漏洞**

### 漏洞描述：

docker是一种开源的应用容器引擎，这个漏洞是利用docker对外开放的一个api接口，因为权限设置不当，导致可以远程命令执行。

### 漏洞测试：

首先探测2375端口，如果开放，再构造http:localhost:2375/version请求，如果返回包带有json格式，说明存在该漏洞。

进一步测试，这里不再说明。

### 漏洞危害：

通过此漏洞，可在docker命令执行，并且影响宿主机。

### 漏洞修复：

1.关闭2375端口

## **6.**openssl**公钥密码过弱漏洞**

### 漏洞描述：

openssl协议使用的公钥太弱，导致被暴力猜解。

### 漏洞检测：

使用：openssl s_client -connect  122.227.230.67:60008 —ssl3

其支持的版本探测：

-ssl2         - just use SSLv2

-ssl3         - just use SSLv3

-tls1_2       - just use TLSv1.2

-tls1_1       - just use TLSv1.1

-tls1         - just use TLSv1

-dtls1        - just use DTLSv1

检测原理：用openssl尝试去连接，如果返回

eer signing digest: SHA512

Server Temp Key: ECDH, P-256, 256 bits

​    

SSL handshake has read 1413 bytes and written 458 bytes

​    

New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES128-SHA

Server public key is 2048 bit

Secure Renegotiation IS supported

Compression: NONE

Expansion: NONE

No ALPN negotiated

SSL-Session:

```
Protocol  : TLSv1.2

Cipher    : ECDHE-RSA-AES128-SHA

Session-ID: 58E72FA84E256939BC49FB68087AC9065E071C4BE557DBF99D40270E70D9F674

Session-ID-ctx:

Master-Key: EF828328DBDA5C9E5B187C483C1A526D1C052FBC16C6CBC8DB90544E0751FBD28F8A9D081101A6675A9DFC3AF33708BC

Key-Arg   : None

PSK identity: None

PSK identity hint: None

SRP username: None

Start Time: 1491546024

Timeout   : 300 \(sec\)

Verify return code: 18 \(self signed certificate\)
```

​    

说明连接成功，里面包含一些信息，如果返回

140735260164176:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake failure:s3_pkt.c:656:

表示握手失败。

### 漏洞修复：

升级openssl为最新版本，使用ssl3版本。

## **7.**OpenSSL ASN.1**编码器内存破坏漏洞**

### 漏洞描述：

OpenSSL中的ASN.1解析器在对数据解析时没有正确处理特定标签，当遇到V_ASN1_NEG_INTEGER和V_ASN1_NEG_ENUMERATED标签时，ASN.1解析器也会将其视作ASN1_ANY类型，从而解析其中的数据。当数据再次编码序列化时，可能造成数据越界写入，引起内存损坏。

**受影响系统：**

OpenSSL Project OpenSSL 1.0.2

OpenSSL Project OpenSSL 1.0.1

**不受影响系统：**

OpenSSL Project OpenSSL 1.0.2c

OpenSSL Project OpenSSL 1.0.1o

### 漏洞检测：

基于openssl版本检测

### 漏洞修复：

升级openssl

## **8.**OpenSSL AES-NI CBC Padding Oracle MAC漏洞

### 漏洞描述：

OpenSSL 1.0.2, 1.0.1版本未充分修补CVE-2013-0169（Lucky 13 padding attack）漏洞。可使中间人攻击者解密使用AES CBC模式加密的网络流量。此漏洞源于在CVE-2013-0169的修复中, 虽然通过对填充字段的检查，确保每次都读取相同字节并比较消息摘要和填充字节的数据, 但其没有检查是否有足够的空间容纳消息摘要和填充字节的数据。

**受影响系统：**

OpenSSL Project OpenSSL <1.0.2h

OpenSSL Project OpenSSL <1.0.1t

**不受影响系统：**

OpenSSL Project OpenSSL 1.0.2h

OpenSSL Project OpenSSL 1.0.1t

### 漏洞检测：

基于openssl版本检测

### 漏洞修复：

升级openssl版本

## **9.**Samba**远程代码执行漏洞**

### 漏洞描述：

Samba是Linux和UNIX系统的SMB协议服务软件，可以实现与其他操作系统（如：微软Windows操作系统）进行文件系统、打印机和其他资源的共享。此次漏洞最早影响到7年前的版本，黑客可以利用漏洞进行远程代码执行。

##### 漏洞影响版本：Samba 3.5.0到4.6.4/4.5.10/4.4.14的中间版本。

### 漏洞检测：

基于samba版本的检测

### 漏洞危害：

可导致安装了samba服务的服务器被远程命令执行

### 漏洞修复：

1.打相关补丁

2.升级到Samba 4.6.4/4.5.10/4.4.14任意版本

3.在smb.conf的[global]板块中添加参数：nt pipe support = no 然后重启smbd服务。

## **10.**SMB远程命令执行漏洞

### 漏洞描述：

windows系统如果开启了SMB协议，可以实现与其他机子进行文件系统、打印机和其他资源的共享，黑客可以利用漏洞进行远程代码执行。

### 漏洞检测：

windows服务器开启了445端口，且没有打MS17-010补丁的即存在此漏洞

### 漏洞危害：

可导致开启了SMB服务的服务器被远程命令执行

### 漏洞修复：

1.关闭445端口，或者上防护设备限制特定ip访问。

2.打微软MS17-010补丁





